<?php require_once("includes/session.php");?>
<?php require_once("includes/db_connection.php");?>
<?php require_once("includes/functions.php");?>
<?php require_once("includes/validation_functions.php"); ?>
<?php
if (logged_in()) {
    redirect_to ("public/Inside/buzz.php");
}
?>
<?php
            $sname = $_POST['name'];
            $username = mysql_prep($_POST["register"]);
            $email = $_POST['email'];
            $password=$_POST['password'];
 $query_ucheck = "SELECT username FROM users WHERE username = '{$username}'";
    $result_ucheck = mysqli_query($conn, $query_ucheck);
    if (mysqli_num_rows($result_ucheck) !=0) {
        echo "Username already exists";
    } else {

        
            
            $retval1 = ereg("(@vit.ac.in$)", $email);
            $retval2 = ereg("(^@vit.ac.in)", $email);
            if( $retval1 == true && $retval2==false )
            {
                $hashed_password = password_encrypt($password); 
                $confirmcode = rand(); 
                $query = "INSERT INTO users (sname, username, email, hashed_password, confirmed, confirm_code)";
                $query .= " VALUES ('{$sname}', '{$username}', '{$email}', '{$hashed_password}', '0', '{$confirmcode}')";
                $result = mysqli_query($conn, $query);         

                if ($result) {
                    $found_user = attempt_login($username, $password);

                    if ($found_user) {

                        $message ="<html><head>"'<meta name="viewport" content="width=device-width"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>*|MC:SUBJECT|*</title><style type="text/css">p{margin:1em 0}a{word-wrap:break-word}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{display:block;margin:0;padding:0}img,a img{border:0;height:auto;outline:none;text-decoration:none}body,#bodyTable,#bodyCell{height:100% !important;margin:0;padding:0;width:100% !important}#outlook a{padding:0}img{-ms-interpolation-mode:bicubic}table{mso-table-lspace:0pt;mso-table-rspace:0pt}.ReadMsgBody{width:100%}.ExternalClass{width:100%}p,a,li,td,blockquote{mso-line-height-rule:exactly}a[href^=tel],a[href^=sms]{color:inherit;cursor:default;text-decoration:none}p,a,li,td,body,table,blockquote{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}.ExternalClass,.ExternalClass p,.ExternalClass td,.ExternalClass div,.ExternalClass span,.ExternalClass font{line-height:100%}#bodyCell{padding-top:20px;padding-right:10px;padding-bottom:20px;padding-left:10px}.templateContainer{max-width:600px}.columnsContainer{max-width:298px}a.mcnButton{display:block}.mcnImage{vertical-align:bottom}.mcnTextContent img{height:auto !important}body,#bodyTable{background-color:#F2F2F2}#bodyCell{border-top:0}.templateContainer{border:0}h1{color:#606060 !important;font-family:Helvetica;font-size:40px;font-style:normal;font-weight:bold;line-height:125%;letter-spacing:-1px;text-align:left}h2{color:#404040 !important;;font-family:Helvetica;font-size:26px;font-style:normal;font-weight:bold;line-height:125%;letter-spacing:-.75px;text-align:left}h3{color:#606060 !important;font-family:Helvetica;font-size:18px;font-style:normal;font-weight:bold;line-height:125%;letter-spacing:-.5px;text-align:left}h4{color:#808080 !important;font-family:Helvetica;font-size:16px;font-style:normal;font-weight:bold;line-height:125%;letter-spacing:normal;text-align:left}#templatePreheader{background-color:#FFF;border-top:0;border-bottom:0}.preheaderContainer .mcnTextContent,.preheaderContainer .mcnTextContent p{color:#606060;font-family:Helvetica;font-size:11px;line-height:125%;text-align:left}.preheaderContainer .mcnTextContent a{color:#606060;font-weight:normal;text-decoration:underline}#templateHeader{background-color:#FFF;border-top:0;border-bottom:0}.headerContainer .mcnTextContent,.headerContainer .mcnTextContent p{color:#606060;font-family:Helvetica;font-size:15px;line-height:150%;text-align:left}.headerContainer .mcnTextContent a{color:#6DC6DD;font-weight:normal;text-decoration:underline}#templateUpperBody{background-color:#FFF;border-top:0;border-bottom:0}.upperBodyContainer .mcnTextContent,.upperBodyContainer .mcnTextContent p{color:#606060;font-family:Helvetica;font-size:15px;line-height:150%;text-align:left}.upperBodyContainer .mcnTextContent a{color:#6DC6DD;font-weight:normal;text-decoration:underline}#templateColumns{background-color:#FFF;border-top:0;border-bottom:0}.leftColumnContainer .mcnTextContent,.leftColumnContainer .mcnTextContent p{color:#606060;font-family:Helvetica;font-size:15px;line-height:150%;text-align:left}.leftColumnContainer .mcnTextContent a,.leftColumnContainer .mcnTextContent p a{color:#6DC6DD;font-weight:normal;text-decoration:underline}.rightColumnContainer .mcnTextContent,.rightColumnContainer .mcnTextContent p{color:#606060;font-family:Helvetica;font-size:15px;line-height:150%;text-align:left}.rightColumnContainer .mcnTextContent a,.rightColumnContainer .mcnTextContent p a{color:#6DC6DD;font-weight:normal;text-decoration:underline}#templateLowerBody{background-color:#FFF;border-top:0;border-bottom:0}.lowerBodyContainer .mcnTextContent,.lowerBodyContainer .mcnTextContent p{color:#606060;font-family:Helvetica;font-size:15px;line-height:150%;text-align:left}.lowerBodyContainer .mcnTextContent a{color:#6DC6DD;font-weight:normal;text-decoration:underline}#templateFooter{background-color:#FFF;border-top:0;border-bottom:0}.footerContainer .mcnTextContent,.footerContainer .mcnTextContent p{color:#606060;font-family:Helvetica;font-size:11px;line-height:125%;text-align:center}.footerContainer .mcnTextContent a{color:#606060;font-weight:normal;text-decoration:underline}@media screen and (min-width:768px){.templateContainer{width:600px !important}}@media screen and (min-width:768px){.columnsContainer{width:298px}}@media only screen and (max-width:480px){body{width:100% !important;min-width:100% !important}}@media only screen and (max-width:480px){td#bodyCell{padding-top:10px !important}}@media only screen and (max-width:480px){.columnsContainer{max-width:100% !important;width:100% !important}}@media only screen and (max-width:480px){img.mcnImage,table.mcnShareContent,table.mcnCaptionTopContent,table.mcnCaptionBottomContent,table.mcnTextContentContainer,table.mcnBoxedTextContentContainer,table.mcnImageGroupContentContainer,table.mcnCaptionLeftTextContentContainer,table.mcnCaptionRightTextContentContainer,table.mcnCaptionLeftImageContentContainer,table.mcnCaptionRightImageContentContainer,table.mcnImageCardLeftTextContentContainer,table.mcnImageCardRightTextContentContainer{width:100% !important}}@media only screen and (max-width:480px){td.mcnImageGroupContent{padding:9px !important}}@media only screen and (max-width:480px){table.mcnCaptionLeftContentOuter td.mcnTextContent,table.mcnCaptionRightContentOuter td.mcnTextContent{padding-top:9px !important}}@media only screen and (max-width:480px){td.mcnImageCardTopImageContent,td.mcnCaptionBlockInner table.mcnCaptionTopContent:last-child td.mcnTextContent{padding-top:18px !important}}@media only screen and (max-width:480px){td.mcnImageCardBottomImageContent{padding-bottom:9px !important}}@media only screen and (max-width:480px){td.mcnImageGroupBlockInner{padding-top:0 !important;padding-bottom:0 !important}}@media only screen and (max-width:480px){tbody.mcnImageGroupBlockOuter{padding-top:9px !important;padding-bottom:9px !important}}@media only screen and (max-width:480px){td.mcnTextContent,td.mcnBoxedTextContentColumn{padding-right:18px !important;padding-left:18px !important}}@media only screen and (max-width:480px){td.mcnImageCardLeftImageContent,td.mcnImageCardRightImageContent{padding-right:18px !important;padding-bottom:0 !important;padding-left:18px !important}}@media only screen and (max-width:480px){td.columnsContainer{display:block !important;max-width:600px !important;width:100% !important}}@media only screen and (max-width:480px){table.mcpreview-image-uploader{display:none !important;width:100% !important}}@media only screen and (max-width:480px){td.footerContainer a.utilityLink{display:block !important}}@media only screen and (max-width:480px){h1{font-size:24px !important;line-height:125% !important}}@media only screen and (max-width:480px){h2{font-size:20px !important;line-height:125% !important}}@media only screen and (max-width:480px){h3{font-size:18px !important;line-height:125% !important}}@media only screen and (max-width:480px){h4{font-size:16px !important;line-height:125% !important}}@media only screen and (max-width:480px){table.mcnBoxedTextContentContainer td.mcnTextContent,td.mcnBoxedTextContentContainer td.mcnTextContent p{font-size:18px !important;line-height:125% !important}}@media only screen and (max-width:480px){td#templatePreheader{display:block !important}}@media only screen and (max-width:480px){td.preheaderContainer td.mcnTextContent,td.preheaderContainer td.mcnTextContent p{font-size:14px !important;line-height:115% !important}}@media only screen and (max-width:480px){td.headerContainer td.mcnTextContent,td.headerContainer td.mcnTextContent p{font-size:18px !important;line-height:125% !important}}@media only screen and (max-width:480px){td.upperBodyContainer td.mcnTextContent,td.upperBodyContainer td.mcnTextContent p{font-size:18px !important;line-height:125% !important}}@media only screen and (max-width:480px){td.leftColumnContainer td.mcnTextContent,td.leftColumnContainer td.mcnTextContent p{font-size:16px !important;line-height:125% !important}}@media only screen and (max-width:480px){td.rightColumnContainer td.mcnTextContent,td.rightColumnContainer td.mcnTextContent p{font-size:16px !important;line-height:125% !important}}@media only screen and (max-width:480px){td.lowerBodyContainer td.mcnTextContent,td.lowerBodyContainer td.mcnTextContent p{font-size:18px !important;line-height:125% !important}}@media only screen and (max-width:480px){td.footerContainer td.mcnTextContent,td.footerContainer td.mcnTextContent p{font-size:14px !important;line-height:115% !important}}</style></head><body><h1>Hello</h1></body>';
                        mail($email, "Confirm your email", $message, "From: cambuzz.vitcc@gmail.com");
                        echo "Kindly check your VIT email and confirm your registration after closing this signup form.";
                        echo "<br>"; 
                        echo"(Check your spam folder if you don't find it in your inbox.)";
                    } 
                } 
            }
            else{
                echo "Only VIT email is recognised";
            }                       
        
    }     

?>